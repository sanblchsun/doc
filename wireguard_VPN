Ресурсы:
https://www.youtube.com/@zproger/videos
https://t.me/codeblog8
Настройка Сервера
1. Обновление баз и пакетов:
sudo apt update && apt upgrade
2. Установка wireguard, fish и micro:
sudo apt install fish wireguard micro
3. Генерируем ключи сервера:
wg genkey | tee /etc/wireguard/server_private_key | wg pubkey | tee /etc/wireguard/server_public_key
4. Выдаем доступ к приват ключу только для root:
chmod 600 /etc/wireguard/server_private_key
5. Извлекаем сетевой интерфейс
ip a | grep "mtu 1500"
6. Создаем конфиг на сервере:
micro /etc/wireguard/wg0.conf
[Interface]
Address = 10.0.0.1/24
ListenPort = 51830
PrivateKey = приватный_ключ_сервера (cat /etc/wireguard/server_private_key)
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o
eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o
eth0 -j MASQUERADE
* выделенное красным заменить на свое
7. Разрешаем IPv4 форвардинг:
echo "net.ipv4.ip_forward=1" >> /etc/sysctl.conf && sysctl -p
8. Проверяем на корректность:
cat /etc/sysctl.conf | grep "net.ipv4.ip_forward=1"
9. Запускаем службу и добавляем в автозагрузку
systemctl enable wg-quick@wg0.service
systemctl start wg-quick@wg0.service
systemctl status wg-quick@wg0.serviceНастройка Клиента
1. Генерируем ключи клиента:
sudo wg genkey | sudo tee /etc/wireguard/client_private_key | sudo wg pubkey | sudo tee
/etc/wireguard/client_public_key
2. Редактируем конфигурацию на сервере (/etc/wireguard/wg0.conf):
В конец конфига добавляем:
[Peer]
PublicKey = публичный_ключ_клиента (cat /etc/wireguard/client_public_key)
AllowedIPs = 10.0.0.2/32
* выделенное красным заменить на свое
3. Перезапускаем службу:
systemctl restart wg-quick@wg0
systemctl status wg-quick@wg0
Подключение к VPN
1. Создаем конфиг для подключения на клиенте:
micro ~/vpn.conf
вставляем следующий конфиг:
[Interface]
PrivateKey = приват_ключ_клиента (cat /etc/wireguard/client_private_key)
Address = 10.0.0.2/32
DNS = 8.8.8.8
[Peer]
PublicKey = публичный_ключ_сервера (cat /etc/wireguard/server_public_key)
Endpoint = айпи_сервера:51830
AllowedIPs = 0.0.0.0/0
PersistentKeepalive = 20
2. Переместить конфиг в директорию WireGuard:
mv ~/vpn.conf /etc/wireguard/wg0-client.conf
2. Включить и Выключить VPN:
wg-quick up wg0-client
wg-quick down wg0-client
